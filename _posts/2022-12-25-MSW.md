---
title: "MSW"
date: "2022-12-15 00:00:00"
categories: [FE, MSW]
tags: [msw, react] # TAGëŠ” ë°˜ë“œì‹œ ì†Œë¬¸ìë¡œ ì´ë£¨ì–´ì ¸ì•¼í•¨!
---

## ğŸ“Œ MSW(Mock Service Worker)

### âœï¸ MSW

ê¸°ì¡´ API ëª¨í‚¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëŒ€ë¹„ MSWì˜ ê°€ì¥ í° ê°•ì ì€ ëª¨í‚¹ì´ ë„¤íŠ¸ì›Œí¬ ë‹¨ì—ì„œ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì— í”„ëŸ°íŠ¸ì•¤ë“œ ì½”ë“œë¥¼ ì‹¤ì œ ë°±ì•¤ë“œ APIì™€ ë„¤íŠ¸ì›Œí¬ í†µì‹ í•˜ëŠ” ê²ƒê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ë§ì€ ë‚˜ì¤‘ì— ê°€ì§œ APIë¥¼ ì‹¤ì œ APIë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì‰½ë‹¤ëŠ” ëœ»ì´ë©° ê·¸ë§Œí¼ í”„ëŸ°íŠ¸ì•¤ë“œ í”„ë¡œì íŠ¸ì˜ ê°œë°œ ìƒì‚°ì„±ì´ ì˜¬ë¼ê°€ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

### âœï¸ MSW ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

```javascript
$ npm i -D msw
```

### âœï¸ ì„œë¹„ìŠ¤ ì›Œì»¤ ì½”ë“œ ìƒì„±í•˜ê¸°

MSWëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ í†µí•´ì„œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ì„ ìœ„í•œ ê¸°ë³¸ì ì¸ ì½”ë“œê°€ í•„ìš”í•œë°ìš”. ë‹¤í–‰íˆë„ ì„œë¹„ìŠ¤ ì›Œì»¤ì— ëŒ€í•´ì„œ ì˜ ëª°ë¼ë„ MSWì—ì„œ ì œê³µí•˜ëŠ” CLI ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ì½”ë“œë¥¼ ì‰½ê²Œ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
$ npx msw init public/ --save
```

### âœï¸ ìš”ì²­ í•¸ë“¤ëŸ¬ ì‘ì„±

ê°€ì§œ APIë¥¼ êµ¬í˜„í•˜ë ¤ë©´ ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ ì„ì˜ì˜ ì‘ë‹µì„ í•´ì£¼ëŠ” í•¸ë“¤ëŸ¬(handler) ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼í•©ë‹ˆë‹¤.

src/mocks/hander.js

```javascript
import { rest } from "msw";

const todos = ["ë¨¹ê¸°", "ìê¸°", "ë†€ê¸°"];

export const handlers = [
  // í• ì¼ ëª©ë¡
  rest.get("/todos", (req, res, ctx) => {
    return res(ctx.status(200), ctx.json(todos));
  }),

  // í• ì¼ ì¶”ê°€
  rest.post("/todos", (req, res, ctx) => {
    todos.push(req.body);
    return res(ctx.status(201));
  }),
];
```

### âœï¸ ì„œë¹„ìŠ¤ ì›Œì»¤ ìƒì„±

ë‹¤ìŒìœ¼ë¡œ msw ëª¨ë“ˆì—ì„œ ì œê³µí•˜ëŠ” setupWorker() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì‘ì„±í•œ ìš”ì²­ í•¸ë“¤ëŸ¬ ì½”ë“œë¥¼ ë¶ˆëŸ¬ì™€ì„œ ê·¸ëŒ€ë¡œ setupWorker() í•¨ìˆ˜ì˜ ì¸ìë¡œ ë„˜ê²¨ì£¼ë©´ ë©ë‹ˆë‹¤.

src/mocks/worker.js

```javascript
import { setupWorker } from "msw";
import { handlers } from "./handlers";

export const worker = setupWorker(...handlers);
```

### âœï¸ ì„œë¹„ìŠ¤ ì›Œì»¤ ì‚½ì…

ì´ì œ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ êµ¬ë™í•˜ëŠ” ì½”ë“œë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì§„ì… ì‹œì (entrypoint)ì— ì‚½ì…ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Create React Appìœ¼ë¡œ ë§Œë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê²½ìš°, src/index.js íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

src/index.js

```javascript
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";

import App from "./App";

//ì—¬ê¸° ì¶”ê°€
import { worker } from "./mocks/worker";
if (process.env.NODE_ENV === "development") {
  worker.start();
}

const rootElement = document.getElementById("root");
const root = createRoot(rootElement);

root.render(
  <StrictMode>
    <App />
  </StrictMode>
);
```

### âœï¸ ì„œë¹„ìŠ¤ ì›Œì»¤ í…ŒìŠ¤íŠ¸

ì´ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™ í›„ì— ë¸Œë¼ìš°ì €ì—ì„œ ì—´ë©´ ì½˜ì†”ì— ë‹¤ìŒê³¼ ê°™ì´ ëª¨í‚¹ì´ í™œì„±í™”ë˜ì—ˆë‹¤ëŠ” ë©”ì„¸ì§€ê°€ ì¶œë ¥ë  ê²ƒ ì…ë‹ˆë‹¤.

```
[MSW] Mocking enabled.
```

ì´ì œ fetch() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì •ë§ë¡œ GET /todosì— ìš”ì²­ì„ ë³´ë‚´ë©´ ê°€ì§œ ì‘ë‹µì´ ì˜¤ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

```javascript
fetch("/todos")
  .then((response) => response.json())
  .then((data) => console.log(data));
```

```
[MSW] 22:09:24 GET /todos (200 OK)
['ë¨¹ê¸°', 'ìê¸°', 'ë†€ê¸°']
```

### âœï¸ í…ŒìŠ¤íŠ¸ ì„œë²„ ì‘ì„±

MSWëŠ” ê°œë°œì—ì„œ ë¿ë§Œ ì•„ë‹ˆë¼ í…ŒìŠ¤íŠ¸ì—ì„œë„ í™œìš©í•  ìˆ˜ ìˆë‹¤ê³  ë§ì”€ë“œë ¸ì£ ? msw/node ëª¨ë“ˆì˜ setupServer() í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸ìš© API ì„œë²„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë°ìš”. ìœ„ì—ì„œ ì‘ì„±í•œ ê°€ì§œ ì‘ë‹µì„ í•´ì£¼ëŠ” ìš”ì²­ í•¸ë“¤ëŸ¬ë¥¼ ê·¸ëŒ€ë¡œ ì¬í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤.

src/mocks/server.js

```javascript
import { setupServer } from "msw/node";
import { handlers } from "./handlers";

export const server = setupServer(...handlers);
```

### âœï¸ í…ŒìŠ¤íŠ¸ ì„œë²„ ì„¤ì •

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ì— ê°€ì§œ API ì„œë²„ë¥¼ ì˜¬ë ¸ë‹¤ê°€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ì— ë‚´ë¦´ ìˆ˜ ìˆë„ë¡ Jest ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Create React Appìœ¼ë¡œ ë§Œë“  í”„ë¡œì íŠ¸ì—ì„œëŠ” setupTests.jsì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

src/setupTests.js

```javascript
import "@testing-library/jest-dom";
import { server } from "./mocks/server";

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

src/App.test.jax

```javascript
import { render, screen } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import App from "./App";

test("renders todos", async () => {
  render(<App />);

  const listitems = await screen.findAllByRole("listitem");
  expect(listitems).toHaveLength(3);

  userEvent.type(screen.getByRole("textbox"), "ê³µë¶€í•˜ê¸°");
  userEvent.click(screen.getByRole("button"));

  expect(await screen.findByText("ê³µë¶€í•˜ê¸°")).toBeInTheDocument();
});
```

<a href='https://www.daleseo.com/mock-service-worker/'>https://www.daleseo.com/mock-service-worker/</a>
