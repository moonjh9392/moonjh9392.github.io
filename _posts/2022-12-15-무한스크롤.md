---
title: "ë¬´í•œìŠ¤í¬ë¡¤"
date: "2022-12-15 00:00:00"
categories: [React]
tags: [react, scroll, infinity] # TAGëŠ” ë°˜ë“œì‹œ ì†Œë¬¸ìë¡œ ì´ë£¨ì–´ì ¸ì•¼í•¨!
---

## ğŸ“Œ ë¦¬ì•¡íŠ¸ ë¬´í•œìŠ¤í¬ë¡¤(infinity scroll) êµ¬í˜„í•˜ê¸°

### âœï¸ êµ¬í˜„ ë°©ë²•

1. Scroll Eventë¥¼ ê°ì§€í•˜ê³ , í•´ë‹¹ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ìŠ¤í¬ë¡¤ê°’ì„ ë¹„êµ
2. Javascriptì—ì„œ ì§€ì›í•˜ëŠ” Observer APIë¥¼ í™œìš©

## ğŸ“Œ Scroll Eventë¥¼ ê°ì§€í•˜ê³ , í•´ë‹¹ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ìŠ¤í¬ë¡¤ê°’ì„ ë¹„êµ

### âœï¸ Scroll.tsx

```javascript
import axios from 'axios';
import { useRef, useState } from 'react';
import Loading from './common/Loading';
import useInfiniteScroll from './useInfiniteScroll';

export const Scroll = () => {
  console.log('scroll');
  const idx = useRef<number>(0);
  const [list, setList] = useState<object[]>([]);
  console.log(list);

  const fetchList = async () => {
    console.log('fetch');
    const addList = await axios.get(`http://localhost:3001/data${idx.current}`);
    console.log(list, addList.data);
    await setList([...list, addList.data]);
    idx.current++;
  };
  const { isEnd } = useInfiniteScroll({ onScrollEnd: fetchList });
  return (
    <div>
      {list.map((item, idx) => (
        <div key={idx}>
          <br />
          {item.toString()}
        </div>
      ))}
      {isEnd && <Loading />}
    </div>
  );
};

```

### âœï¸ useinfiniteScroll.ts

```javascript
import { useEffect, useState, useCallback } from "react";

type OptionType = {
  onScrollEnd?: () => void,
};

type ReturnType = {
  isEnd: boolean,
};

const useInfiniteScroll = ({ onScrollEnd }: OptionType): ReturnType => {
  console.log("useinfi");
  const lockScroll = useCallback(() => {
    document.body.style.overflow = "hidden";
  }, []);

  const unlockScroll = useCallback(() => {
    document.body.style.overflow = "";
  }, []);

  const [isEnd, setIsEnd] = useState(false);

  const handleScroll = async () => {
    console.log("handleScroll");
    const scrollHeight = document.documentElement.scrollHeight;
    const scrollTop = document.documentElement.scrollTop;
    const clientHeight = document.documentElement.clientHeight;

    // console.log(scrollHeight, scrollTop, clientHeight);

    if (scrollTop + clientHeight >= scrollHeight) {
      setIsEnd(true);
      lockScroll();
      if (onScrollEnd) await onScrollEnd();
      await unlockScroll();
      await setIsEnd(false);
    }
  };

  useEffect(() => {
    console.log("mount");
    window.addEventListener("scroll", handleScroll);
    // console.log(window);
    return () => {
      console.log("cleanup");
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return { isEnd };
};

export default useInfiniteScroll;
```

### âœï¸ jsonserver

data.json

```
{
  "data0": [1, 2, 3, 4],
  "data1": [5, 6, 7, 8],
  "data2": [9, 10, 11, 12],
  "data3": [13, 14, 15, 16]
}

```

### âœï¸ ì„¤ëª…

ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì„ ê°ì§€í• ë•Œë§ˆë‹¤ fetchì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ í™”ë©´ì— ë¿Œë ¤ì¤€ë‹¤

git ë„£ì„ ìë¦¬

ì‚¬ì§„ ë„£ì„ìë¦¬

ì´ë ‡ê²Œ í•˜ë©´ ìœ„ì˜ ì‚¬ì§„ì²˜ëŸ¼ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ê°€ ê³¼ë‹¤í•˜ê²Œ ë°œìƒë˜ëŠ”ë°

lodashì˜ throttleì„ ì´ìš©í•´ ì»¨íŠ¸ë¡¤ ê°€ëŠ¥í•˜ë‹¤.

```javascript
import { useEffect, useState, useCallback } from "react";
import { throttle } from "lodash";

type OptionType = {
  onScrollEnd?: () => void,
};

type ReturnType = {
  isEnd: boolean,
};

const useInfiniteScroll = ({ onScrollEnd }: OptionType): ReturnType => {
  console.log("useinfi");
  const lockScroll = useCallback(() => {
    document.body.style.overflow = "hidden";
  }, []);

  const unlockScroll = useCallback(() => {
    document.body.style.overflow = "";
  }, []);

  const [isEnd, setIsEnd] = useState(false);

  const handleScroll = throttle(async () => {
    console.log("handleScroll");
    const scrollHeight = document.documentElement.scrollHeight;
    const scrollTop = document.documentElement.scrollTop;
    const clientHeight = document.documentElement.clientHeight;

    // console.log(scrollHeight, scrollTop, clientHeight);

    if (scrollTop + clientHeight >= scrollHeight) {
      setIsEnd(true);
      lockScroll();
      if (onScrollEnd) await onScrollEnd();
      await unlockScroll();
      await setIsEnd(false);
    }
  }, 300);

  useEffect(() => {
    console.log("mount");
    window.addEventListener("scroll", handleScroll);
    // console.log(window);
    return () => {
      console.log("cleanup");
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return { isEnd };
};

export default useInfiniteScroll;
```

ì‚¬ì§„2

ì‹œì—°ì‹œê°„ 300msë¥¼ ì£¼ì–´ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ê°€ ë§ì´ ì¤„ì€ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ğŸ“Œ 2. Javascriptì—ì„œ ì§€ì›í•˜ëŠ” Observer APIë¥¼ í™œìš©
