---
title: "ë¬´í•œìŠ¤í¬ë¡¤"
date: "2022-12-15 00:00:00"
categories: [FE, React]
tags: [react, scroll, infinite] # TAGëŠ” ë°˜ë“œì‹œ ì†Œë¬¸ìë¡œ ì´ë£¨ì–´ì ¸ì•¼í•¨!
---

## ğŸ“Œ ë¦¬ì•¡íŠ¸ ë¬´í•œìŠ¤í¬ë¡¤(infinite scroll) êµ¬í˜„í•˜ê¸°

### âœï¸ êµ¬í˜„ ë°©ë²•

1. Scroll Eventë¥¼ ê°ì§€í•˜ê³ , í•´ë‹¹ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ìŠ¤í¬ë¡¤ê°’ì„ ë¹„êµ
2. Javascriptì—ì„œ ì§€ì›í•˜ëŠ” Observer APIë¥¼ í™œìš©

## ğŸ“Œ Scroll Eventë¥¼ ê°ì§€í•˜ê³ , í•´ë‹¹ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ìŠ¤í¬ë¡¤ê°’ì„ ë¹„êµ

### âœï¸ Scroll.tsx

```javascript
import axios from 'axios';
import { useRef, useState } from 'react';
import Loading from './common/Loading';
import useInfiniteScroll from './useInfiniteScroll';

export const Scroll = () => {
  console.log('scroll');
  const idx = useRef<number>(0);
  const [list, setList] = useState<object[]>([]);
  console.log(list);


  const fetchList = async () => {
    console.log('fetch');
    const addList = await axios.get(`http://localhost:3001/data${idx.current}`);
    console.log(list, addList.data);
    await setList([...list, addList.data]);
    idx.current++;
  };
  const { isEnd } = useInfiniteScroll({ onScrollEnd: fetchList });
  return (
    <div>
      {list.map((item, idx) => (
        <div key={idx}>
          <br />
          {item.toString()}
        </div>
      ))}
      {isEnd && <Loading />}
    </div>
  );
};

```

### âœï¸ useinfiniteScroll.ts

```javascript
import { useEffect, useState, useCallback } from "react";

type OptionType = {
  onScrollEnd?: () => void,
};

type ReturnType = {
  isEnd: boolean,
};

const useInfiniteScroll = ({ onScrollEnd }: OptionType): ReturnType => {
  console.log("useinfi");
  const lockScroll = useCallback(() => {
    document.body.style.overflow = "hidden";
  }, []);

  const unlockScroll = useCallback(() => {
    document.body.style.overflow = "";
  }, []);

  const [isEnd, setIsEnd] = useState(false);

  const handleScroll = async () => {
    console.log("handleScroll");
    const scrollHeight = document.documentElement.scrollHeight;
    const scrollTop = document.documentElement.scrollTop;
    const clientHeight = document.documentElement.clientHeight;

    // console.log(scrollHeight, scrollTop, clientHeight);

    if (scrollTop + clientHeight >= scrollHeight) {
      setIsEnd(true);
      lockScroll();
      if (onScrollEnd) await onScrollEnd();
      await unlockScroll();
      await setIsEnd(false);
    }
  };

  useEffect(() => {
    console.log("mount");
    window.addEventListener("scroll", handleScroll);
    // console.log(window);
    return () => {
      console.log("cleanup");
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return { isEnd };
};

export default useInfiniteScroll;
```

handleScroll() ì€ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ì´ë‹¤. height ê³„ì‚°ì„ í†µí•´ ìŠ¤í¬ë¡¤ì´ ëë‚˜ë©´ ë¡œì§ì„ ì‹¤í–‰í•œë‹¤.
scrollHeight : í˜ì´ì§€ì˜ ì´ ë†’ì´ì´ë‹¤. ì´ëŠ”, í™”ë©´ì— ë³´ì´ì§€ ì•ŠëŠ” ë†’ì´ê¹Œì§€ ê³ ë ¤ëœ ë†’ì´ë‹¤.
scrollTop : ì´ë¯¸ ìŠ¤í¬ë¡¤ëœ ë†’ì´ì´ë‹¤. í™”ë©´ ìƒë‹¨ì´ ê¸°ì¤€ì´ ëœë‹¤.
clientHeight : ë¸Œë¼ìš°ì € í™”ë©´, ì¦‰ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” ë†’ì´ì´ë‹¤.

### âœï¸ jsonserver

data.json

```
{
  "data0": [1, 2, 3, 4],
  "data1": [5, 6, 7, 8],
  "data2": [9, 10, 11, 12],
  "data3": [13, 14, 15, 16]
}

```

### âœï¸ ì„¤ëª…

ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì„ ê°ì§€í• ë•Œë§ˆë‹¤ fetchì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ í™”ë©´ì— ë¿Œë ¤ì¤€ë‹¤

![ezgif com-gif-maker](https://user-images.githubusercontent.com/45509511/207811462-064068e6-2498-4d18-89b1-87b72777fa3f.gif)

<img width="590" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-12-15 á„‹á…©á„’á…® 5 20 49" src="https://user-images.githubusercontent.com/45509511/207810975-e35f7990-a833-49e2-880c-60e62ef8e7b1.png">

ì´ë ‡ê²Œ í•˜ë©´ ìœ„ì˜ ì‚¬ì§„ì²˜ëŸ¼ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ê°€ ê³¼ë‹¤í•˜ê²Œ ë°œìƒë˜ëŠ”ë°

lodashì˜ throttleì„ ì´ìš©í•´ ì»¨íŠ¸ë¡¤ ê°€ëŠ¥í•˜ë‹¤.

```javascript
import { useEffect, useState, useCallback } from "react";
import { throttle } from "lodash";

type OptionType = {
  onScrollEnd?: () => void,
};

type ReturnType = {
  isEnd: boolean,
};

const useInfiniteScroll = ({ onScrollEnd }: OptionType): ReturnType => {
  console.log("useinfi");
  const lockScroll = useCallback(() => {
    document.body.style.overflow = "hidden";
  }, []);

  const unlockScroll = useCallback(() => {
    document.body.style.overflow = "";
  }, []);

  const [isEnd, setIsEnd] = useState(false);

  const handleScroll = throttle(async () => {
    console.log("handleScroll");
    const scrollHeight = document.documentElement.scrollHeight;
    const scrollTop = document.documentElement.scrollTop;
    const clientHeight = document.documentElement.clientHeight;

    // console.log(scrollHeight, scrollTop, clientHeight);

    if (scrollTop + clientHeight >= scrollHeight) {
      setIsEnd(true);
      lockScroll();
      if (onScrollEnd) await onScrollEnd();
      await unlockScroll();
      await setIsEnd(false);
    }
  }, 300);

  useEffect(() => {
    console.log("mount");
    window.addEventListener("scroll", handleScroll);
    // console.log(window);
    return () => {
      console.log("cleanup");
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return { isEnd };
};

export default useInfiniteScroll;
```

<img width="607" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-12-15 á„‹á…©á„’á…® 5 26 37" src="https://user-images.githubusercontent.com/45509511/207811090-d136e050-b181-48c6-9247-50a8aed90de4.png">

ì‹œì—°ì‹œê°„ 300msë¥¼ ì£¼ì–´ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ê°€ ë§ì´ ì¤„ì€ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ğŸ“Œ 2. Javascriptì—ì„œ ì§€ì›í•˜ëŠ” Observer APIë¥¼ í™œìš©

### âœï¸ Observer API

Observer patternì€ ê°ì²´ ìƒíƒœë³€í™”ë¥¼ ê´€ì°°í•˜ëŠ” ê´€ì°°ìë“¤(ì˜µì €ë²„)ì„ ë“±ë¡í•˜ì—¬ ìƒíƒœë³€í™”ê°€ ìˆì„ ë•Œë§ˆë‹¤ ê° ì˜µì €ë²„ì— ì•Œë¦¬ëŠ” íŒ¨í„´ì´ë‹¤.

ì´ ë…¼ë¦¬ì— ê¸°ë°˜í•œ Javascript ë‚´ì¥ APIê°€ Observer API ì¸ ê²ƒì´ë‹¤.

1. MutationObserver

DOM ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ì˜µì €ë²„ì´ë‹¤. ìš”ì†Œì˜ ì‚½ì…, ìˆ˜ì •, ì‚­ì œ ë° ìì‹ìš”ì†Œê°€ ìˆ˜ì •ë˜ëŠ” ê²½ìš° ë“±ì„ ê°ì§€í•œë‹¤.

2. ResizeObserver

íƒ€ê²Ÿ ìš”ì†Œê°€ ë¦¬ì‚¬ì´ì§• ì´ë²¤íŠ¸ë¥¼ í†µí•´ í¬ê¸°ê°€ ë³€ê²½ë  ë•Œë¥¼ ê°ì§€í•˜ëŠ” ì˜µì €ë²„ë‹¤. ë°˜ì‘í˜•ìœ¼ë¡œ ë³´ì´ëŠ”ë° ìœ ìš©í•˜ë‹¤.

3. IntersectionObserver

íƒ€ê²Ÿ ìš”ì†Œì™€ ìƒìœ„ ìš”ì†Œ(í˜¹ì€ ìµœìƒìœ„ document)ì˜ viewport ì‚¬ì´ì— êµì°¨ì§€ì ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê´€ì°°í•œë‹¤.

íƒ€ê²Ÿìš”ì†Œê°€ í™”ë©´ì— ì–¼ë§ˆë‚˜ ë³´ì´ëŠ”ì§€ì— ë”°ë¼ ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë¥¼ ì¤„ ìˆ˜ ìˆë‹¤.

### âœï¸ ì‚¬ìš© ë°©ë²•

ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

```javascript
let observer = new IntersectionObserver(callback, options);
```

- callback : êµì°¨ì‹œì— ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ë¡œë”©êµ¬í˜„ì´ë‚˜ íŒ¨ì¹˜ ë“±ì˜ í•¨ìˆ˜ê°€ í†µìƒ í• ë‹¹ëœë‹¤.
  - options : Intersection Observerì— ê´€í•œ ì„¤ì •ì„ í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ë‹¤.
  - root : êµì°¨ë¥¼ ê°ì§€í•˜ëŠ” root ìš”ì†Œ. observeë¡œ ë“±ë¡í•  ìš”ì†Œì˜ ìƒìœ„ìš”ì†Œì—¬ì•¼ í•œë‹¤. ê¸°ë³¸ê°’ì€ null(ì´ ë• ë¸Œë¼ìš°ì € viewport)
  - rootMargin : root ìš”ì†Œì˜ ë§ˆì§„ê°’. ê¸°ë³¸ê°’ì€ 0px.
  - threshold : 0.0 ~ 1.0 ì‚¬ì´ì˜ ìˆ«ìë“¤ì„ ë°°ì—´ë¡œ ë°›ëŠ”ë‹¤. ì´ëŠ” %ë¡œ ì¹˜í™˜ë˜ì–´, í•´ë‹¹ ë¹„ìœ¨ë§Œí¼ êµì°¨ëœ ê²½ìš° ì½œë°±ì´ ì‹¤í–‰ëœë‹¤.

### âœï¸ ì°¸ê³ 

<a href='https://abangpa1ace.tistory.com/259'>https://abangpa1ace.tistory.com/259</a>
